{% extends 'admin/base_admin.html' %}
{% load static %}

{% block title %}Litige #{{ dispute.id.hex|slice:":8" }} - Admin{% endblock %}

{% block extra_css %}
<style>
.admin-dispute-detail {
    background: inherit;
    min-height: 100vh;
    padding: 20px;
    color: #fff;
    width: 100%;
    box-sizing: border-box;
    overflow-x: auto;
}

.dispute-container {
    max-width: 1400px;
    margin: 0 auto;
    min-width: 320px;
}

.dispute-header {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 25px;
    border: 1px solid rgba(138, 43, 226, 0.3);
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 20px;
    align-items: center;
}

.dispute-title {
    margin: 0;
    color: #00ffff;
    font-size: 1.8rem;
}

.dispute-id {
    font-size: 1rem;
    color: #999;
    margin-top: 5px;
}

.dispute-status-section {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 10px;
}

.main-content {
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 25px;
}

.left-column {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.right-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.info-section {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 20px;
    border: 1px solid rgba(138, 43, 226, 0.3);
}

.section-title {
    color: #00ffff;
    margin-bottom: 15px;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.info-label {
    font-size: 0.85rem;
    color: #999;
    text-transform: uppercase;
    font-weight: 500;
}

.info-value {
    font-size: 1rem;
    color: #fff;
    font-weight: 500;
}

.status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
    text-transform: uppercase;
    display: inline-block;
}

.status-pending { background: #ff6b35; color: white; }
.status-in-progress { background: #f7931e; color: white; }
.status-resolved { background: #4caf50; color: white; }
.status-closed { background: #666; color: white; }

.priority-high { color: #ff4757; font-weight: bold; }
.priority-medium { color: #ffa502; }
.priority-low { color: #2ed573; }

.action-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
}

.action-btn {
    background: linear-gradient(45deg, #8a2be2, #4169e1);
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    text-decoration: none;
    font-size: 0.85rem;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.action-btn:hover {
    transform: translateY(-2px);
    color: white;
    text-decoration: none;
    box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
}

.btn-resolve { background: linear-gradient(45deg, #4caf50, #2e7d32); }
.btn-refund { background: linear-gradient(45deg, #f44336, #d32f2f); }
.btn-assign { background: linear-gradient(45deg, #ff9800, #f57c00); }

.transaction-card {
    background: rgba(0, 255, 255, 0.1);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 12px;
    padding: 20px;
}

.transaction-title {
    color: #00ffff;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 15px;
    text-decoration: none;
    display: block;
}

.transaction-title:hover {
    color: #66ffff;
    text-decoration: underline;
}

.user-card {
    background: rgba(138, 43, 226, 0.1);
    border: 1px solid rgba(138, 43, 226, 0.3);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
}

.user-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(45deg, #8a2be2, #00ffff);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.user-name {
    color: #fff;
    font-weight: 600;
    font-size: 1rem;
}

.user-role {
    color: #999;
    font-size: 0.8rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 10px;
}

.stat-item {
    text-align: center;
    padding: 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
}

.stat-number {
    font-size: 1.2rem;
    font-weight: bold;
    color: #00ffff;
}

.stat-label {
    font-size: 0.7rem;
    color: #999;
    text-transform: uppercase;
}

.chat-section {
    max-height: 400px;
    overflow-y: auto;
}

.message {
    background: rgba(255, 255, 255, 0.08);
    padding: 12px 15px;
    border-radius: 10px;
    margin-bottom: 8px;
    border-left: 3px solid #00ffff;
}

.message.seller {
    border-left-color: #8a2be2;
    background: rgba(138, 43, 226, 0.08);
}

.message-header {
    font-weight: 600;
    color: #00ffff;
    margin-bottom: 5px;
    font-size: 0.9rem;
}

.message.seller .message-header {
    color: #8a2be2;
}

.message-content {
    color: #fff;
    line-height: 1.4;
    font-size: 0.9rem;
}

.message-time {
    font-size: 0.75rem;
    color: #999;
    margin-top: 5px;
}

.form-section {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 20px;
    margin-top: 15px;
}

.form-control {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(138, 43, 226, 0.3);
    color: #fff;
    border-radius: 8px;
    padding: 10px 12px;
}

.form-control:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: #8a2be2;
    color: #fff;
    box-shadow: 0 0 0 0.2rem rgba(138, 43, 226, 0.25);
}

.form-control::placeholder {
    color: #999;
}

.btn-primary {
    background: linear-gradient(45deg, #8a2be2, #4169e1);
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(45deg, #9932cc, #4682b4);
    transform: translateY(-1px);
}

.info-requests-grid {
    display: grid;
    gap: 15px;
}

.info-request-card {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    padding: 18px;
    border-left: 4px solid #ff9800;
    overflow: hidden;
    word-wrap: break-word;
    word-break: break-word;
}

.info-request-card.responded {
    border-left-color: #4caf50;
}

.request-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
    flex-wrap: wrap;
    gap: 8px;
}

.request-user {
    color: #00ffff;
    font-weight: 600;
    font-size: 0.95rem;
}

.request-date {
    color: #999;
    font-size: 0.8rem;
}

.request-type-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.request-question {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 12px;
    font-size: 0.9rem;
    line-height: 1.4;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    max-width: 100%;
}

.response-section {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
    border-radius: 8px;
    padding: 15px;
    margin-top: 10px;
}

.response-header {
    color: #4caf50;
    font-weight: 600;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.response-content {
    color: #fff;
    line-height: 1.4;
    margin-bottom: 10px;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    max-width: 100%;
}

.file-download {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: rgba(0, 255, 255, 0.2);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 6px;
    color: #00ffff;
    text-decoration: none;
    font-size: 0.85rem;
    transition: all 0.3s ease;
}

.file-download:hover {
    background: rgba(0, 255, 255, 0.3);
    color: #66ffff;
    text-decoration: none;
}

@media (max-width: 1200px) {
    .main-content {
        grid-template-columns: 1fr;
    }
    
    .right-sidebar {
        order: -1;
    }
}

/* Styles responsive */
@media (max-width: 1200px) {
    .dispute-container {
        max-width: 100%;
        padding: 0 10px;
    }
    
    .info-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
}

@media (max-width: 768px) {
    .admin-dispute-detail {
        padding: 10px;
    }
    
    .dispute-container {
        padding: 0 5px;
    }
    
    .dispute-header {
        grid-template-columns: 1fr;
        text-align: center;
        padding: 15px;
    }
    
    .dispute-status-section {
        align-items: center;
        margin-top: 15px;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .action-buttons {
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .action-btn {
        margin: 5px;
        padding: 8px 12px;
        font-size: 0.9rem;
    }
    
    .dispute-title {
        font-size: 1.4rem;
    }
    
    .status-badge {
        font-size: 0.7rem;
        padding: 3px 6px;
    }
}

@media (max-width: 480px) {
    .admin-dispute-detail {
        padding: 5px;
    }
    
    .dispute-container {
        padding: 0;
    }
    
    .dispute-header {
        padding: 10px;
        margin-bottom: 15px;
    }
    
    .dispute-title {
        font-size: 1.2rem;
    }
    
    .action-btn {
        width: 100%;
        margin: 3px 0;
    }
    
    .info-item {
        padding: 10px;
    }
    
    .info-label {
        font-size: 0.9rem;
    }
    
    .info-value {
        font-size: 0.85rem;
    }
}

.dispute-description-long {
    max-height: 200px;
    overflow-y: auto;
    padding: 10px;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    line-height: 1.6;
    word-wrap: break-word;
    white-space: pre-wrap;
    color: #333;
}

.dispute-description-long::-webkit-scrollbar {
    width: 6px;
}

.dispute-description-long::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.dispute-description-long::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.dispute-description-long::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Gestion du scroll horizontal et des contenus larges */
.admin-dispute-detail {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.dispute-container {
    overflow-x: visible;
}

/* Amélioration du scroll horizontal */
.admin-dispute-detail::-webkit-scrollbar {
    height: 8px;
}

.admin-dispute-detail::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

.admin-dispute-detail::-webkit-scrollbar-thumb {
    background: rgba(138, 43, 226, 0.5);
    border-radius: 4px;
}

.admin-dispute-detail::-webkit-scrollbar-thumb:hover {
    background: rgba(138, 43, 226, 0.7);
}

/* Gestion des contenus qui peuvent déborder */
.info-card, .action-card, .message-card {
    min-width: 0;
    word-wrap: break-word;
    overflow-wrap: break-word;
}

/* Amélioration de la grille pour les petits écrans */
@media (max-width: 1024px) {
    .info-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
}

/* Styles pour les très petits écrans */
@media (max-width: 320px) {
    .admin-dispute-detail {
        padding: 2px;
    }
    
    .dispute-container {
        padding: 0;
    }
    
    .dispute-header {
        padding: 8px;
    }
    
    .dispute-title {
        font-size: 1rem;
    }
    
    .info-item {
        padding: 8px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="admin-dispute-detail">
    <div class="dispute-container">
        <div class="dispute-header">
            <div>
                <div style="margin-bottom: 10px;">
                    <a href="{% url 'admin_dispute_dashboard' %}" class="action-btn" style="background: linear-gradient(45deg, #666, #999); padding: 8px 12px; font-size: 0.8rem;">
                        <i class="fas fa-arrow-left"></i> Retour Dashboard
                    </a>
                </div>
                <h1 class="dispute-title">
                    <i class="fas fa-gavel"></i> Litige Admin
                </h1>
                <div class="dispute-id">#{{ dispute.id.hex|slice:":8" }} • {{ dispute.created_at|date:"d/m/Y H:i" }}</div>
            </div>
            <div class="dispute-status-section">
                <span class="status-badge status-{{ dispute.status }}">{{ dispute.get_status_display }}</span>
                <span class="priority-{{ dispute.priority }}">{{ dispute.get_priority_display }}</span>
            </div>
        </div>
        
        <div class="main-content">
            <div class="left-column">
                <!-- Informations générales -->
                <div class="info-section">
                    <h4 class="section-title">
                        <i class="fas fa-info-circle"></i> Informations du Litige
                    </h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Raison</div>
                            <div class="info-value">{{ dispute.get_reason_display }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Montant</div>
                            <div class="info-value">{{ dispute.disputed_amount }}€</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Ouvert par</div>
                            <div class="info-value">{{ dispute.opened_by.username }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Assigné à</div>
                            <div class="info-value">
                                {% if dispute.assigned_admin %}
                                    {{ dispute.assigned_admin.username }}
                                {% else %}
                                    <em>Non assigné</em>
                                {% endif %}
                            </div>
                        </div>
                        {% if dispute.deadline %}
                        <div class="info-item">
                            <div class="info-label">Échéance</div>
                            <div class="info-value">{{ dispute.deadline|date:"d/m/Y H:i" }}</div>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if dispute.description %}
                    <div style="margin-top: 20px;">
                        <div class="info-label">{% trans "Description" %}</div>
                        <div class="request-question dispute-description-long">{{ dispute.description|linebreaks }}</div>
                    </div>
                    {% endif %}
                    
                    <div class="action-buttons">
                        {% if dispute.status == 'pending' %}
                        <form method="POST" action="{% url 'admin_assign_dispute' dispute.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="action-btn btn-assign">
                                <i class="fas fa-user-plus"></i> M'assigner
                            </button>
                        </form>
                        {% endif %}
                        
                        {% if dispute.status in 'pending,in_progress' %}
                        <a href="{% url 'admin_dispute_resolve_refund' dispute.id %}" class="action-btn btn-refund">
                            <i class="fas fa-undo"></i> Rembourser
                        </a>
                        <a href="{% url 'admin_dispute_resolve_payout' dispute.id %}" class="action-btn btn-resolve">
                            <i class="fas fa-money-bill-wave"></i> Payer vendeur
                        </a>
                        {% endif %}
                    </div>
                </div>

                <!-- Transaction -->
                <div class="info-section">
                    <h4 class="section-title">
                        <i class="fas fa-exchange-alt"></i>{% trans "Transaction" %}</h4>
                    <div class="transaction-card">
                        <a href="{% url 'transaction_detail' dispute.transaction.id %}" class="transaction-title">
                            {{ dispute.transaction.post.title }}
                        </a>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">{% trans "Prix" %}</div>
                                <div class="info-value">{{ dispute.transaction.amount }}€</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">{% trans "Statut" %}</div>
                                <div class="info-value">{{ dispute.transaction.get_status_display }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Créée le</div>
                                <div class="info-value">{{ dispute.transaction.created_at|date:"d/m/Y H:i" }}</div>
                            </div>
                            {% if dispute.transaction.completed_at %}
                            <div class="info-item">
                                <div class="info-label">Finalisée le</div>
                                <div class="info-value">{{ dispute.transaction.completed_at|date:"d/m/Y H:i" }}</div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Messages de chat -->
                <div class="info-section">
                    <h4 class="section-title">
                        <i class="fas fa-comments"></i> Messages de Chat
                    </h4>
                    {% if messages_list %}
                    <div class="chat-section">
                        {% for message in messages_list %}
                        <div class="message {% if message.sender == dispute.transaction.seller %}seller{% endif %}">
                            <div class="message-header">
                                {{ message.sender.username }}
                            </div>
                            <div class="message-content">{{ message.content|linebreaks }}</div>
                            <div class="message-time">{{ message.created_at|date:"d/m/Y H:i" }}</div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p style="color: #999; font-style: italic;">Aucun message échangé pour cette transaction.</p>
                    {% endif %}
                </div>

                <!-- Demandes d'information -->
                <div class="info-section">
                    <h4 class="section-title">
                        <i class="fas fa-question-circle"></i> Demandes d'Information
                    </h4>
                    
                    {% with info_requests=dispute.information_requests.all %}
                    {% if info_requests %}
                        <div class="info-requests-grid">
                            {% for request in info_requests %}
                            <div class="info-request-card {% if request.status == 'responded' %}responded{% endif %}">
                                <div class="request-header">
                                    <div class="request-user">
                                        <i class="fas fa-user"></i> {{ request.requested_to.username }}
                                        <span class="status-badge status-{{ request.status }}">
                                            {{ request.get_status_display }}

                                    </div>
                                    <div class="request-date">{{ request.created_at|date:"d/m/Y H:i" }}</div>
                                </div>
                                
                                <div class="request-type-badge" style="background: {% if request.request_type == 'text_response' %}#2196f3{% elif request.request_type == 'screenshot' %}#ff9800{% else %}#9c27b0{% endif %};">
                                    {{ request.get_request_type_display }}
                                </div>
                                
                                <div class="request-question">
                                    <strong>Question:</strong><br>
                                    {{ request.question|linebreaks }}
                                </div>
                                
                                {% if request.status == 'responded' %}
                                <div class="response-section">
                                    <div class="response-header">
                                        <i class="fas fa-check-circle"></i> Réponse reçue ({{ request.responded_at|date:"d/m/Y H:i" }})
                                    </div>
                                    {% if request.response_text %}
                                    <div class="response-content">
                                        {{ request.response_text|linebreaks }}
                                    </div>
                                    {% endif %}
                                    {% if request.response_file %}
                                    {% load image_filters %}
{% load i18n %}
                                    <a href="{{ request.response_file.url }}" target="_blank" class="file-download">
                                        <i class="fas fa-download"></i> 
                                        <span>Télécharger le fichier</span>
                                    </a>
                                    <!-- Aperçu si c'est une image -->
                                    {% if request.response_file.url %}
                                    <div style="margin-top: 10px;">
                                        <img src="{{ request.response_file.url }}" 
                                             alt="Preuve" 
                                             style="max-width: 100%; max-height: 400px; border-radius: 8px; border: 2px solid rgba(108, 92, 231, 0.3);"
                                             onerror="this.style.display='none'">
                                    </div>
                                    {% endif %}
                                    {% endif %}
                                </div>
                                {% elif request.status == 'pending' %}
                                <div style="color: #ff9800; font-style: italic;">
                                    <i class="fas fa-clock"></i> En attente de réponse avant {{ request.deadline|date:"d/m/Y H:i" }}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p style="color: #999; font-style: italic;">Aucune demande d'information envoyée pour ce litige.</p>
                    {% endif %}
                    {% endwith %}
                    
                    <!-- Formulaire pour envoyer une demande -->
                    <div class="form-section">
                        <h5 style="color: #00ffff; margin-bottom: 15px;">
                            <i class="fas fa-paper-plane"></i> Envoyer une demande d'information
                        </h5>
                        <form method="POST" action="{% url 'admin_send_information_request' dispute.id %}">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Destinataire:</label>
                                    <select name="requested_to" class="form-control" required>
                                        <option value="">Sélectionner...</option>
                                        <option value="{{ dispute.transaction.buyer.id }}">{{ dispute.transaction.buyer.username }} (Acheteur)</option>
                                        <option value="{{ dispute.transaction.seller.id }}">{{ dispute.transaction.seller.username }} (Vendeur)</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Type de réponse demandée:</label>
                                    <select name="request_type" class="form-control" required>
                                        <option value="">Sélectionner...</option>
                                        <option value="text_response">Réponse textuelle</option>
                                        <option value="screenshot">Capture d'écran</option>
                                        <option value="document">Document/Preuve</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Question/Demande:</label>
                                <textarea name="question" class="form-control" rows="4" placeholder="Décrivez ce que vous souhaitez demander à l'utilisateur..." required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Envoyer la demande
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="right-sidebar">
                <!-- Participants -->
                <div class="info-section">
                    <h4 class="section-title">
                        <i class="fas fa-users"></i> Participants
                    </h4>
                    
                    <!-- Acheteur -->
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-avatar">{{ dispute.transaction.buyer.username|first|upper }}</div>
                            <div>
                                <div class="user-name">{{ dispute.transaction.buyer.username }}</div>
                                <div class="user-role">{% trans "Acheteur" %}</div>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number">{{ buyer_stats.total_disputes_as_buyer }}</div>
                                <div class="stat-label">Litiges acheteur</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">{{ buyer_stats.disputes_lost_as_buyer }}</div>
                                <div class="stat-label">Perdus</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vendeur -->
                    <div class="user-card">
                        <div class="user-header">
                            <div class="user-avatar">{{ dispute.transaction.seller.username|first|upper }}</div>
                            <div>
                                <div class="user-name">{{ dispute.transaction.seller.username }}</div>
                                <div class="user-role">{% trans "Vendeur" %}</div>
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number">{{ seller_stats.total_disputes_as_seller }}</div>
                                <div class="stat-label">Litiges vendeur</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">{{ seller_stats.disputes_lost_as_seller }}</div>
                                <div class="stat-label">Perdus</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes administratives -->
                <div class="info-section">
                    <h4 class="section-title">
                        <i class="fas fa-sticky-note"></i> Notes Admin
                    </h4>
                    <form method="POST" action="{% url 'admin_update_dispute_notes' dispute.id %}">
                        {% csrf_token %}
                        <textarea name="admin_notes" class="form-control" rows="6" placeholder="Notes administratives internes...">{{ dispute.admin_notes|default:"" }}</textarea>
                        <button type="submit" class="btn btn-primary mt-2">
                            <i class="fas fa-save"></i>{% trans "Sauvegarder" %}</button>
                    </form>
                </div>

                <!-- Temps de traitement -->
                {% if dispute.response_time_hours or dispute.resolution_time_hours %}
                <div class="info-section">
                    <h4 class="section-title">
                        <i class="fas fa-clock"></i> Temps de Traitement
                    </h4>
                    {% if dispute.response_time_hours %}
                    <div class="info-item">
                        <div class="info-label">Temps de réponse</div>
                        <div class="info-value">{{ dispute.response_time_hours }}h</div>
                    </div>
                    {% endif %}
                    {% if dispute.resolution_time_hours %}
                    <div class="info-item">
                        <div class="info-label">Temps de résolution</div>
                        <div class="info-value">{{ dispute.resolution_time_hours }}h</div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
